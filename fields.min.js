(function(){var t,e,i,n;i=function(){function t(t){this.el=$(t),this.attributes={},this.setupBindings(),this.setAttributes()}return t.prototype.get=function(t){return this.attributes[t]},t.prototype.set=function(t,e){return this.attributes[t]=e,void 0===this.oldAttributes[t]||e!==this.oldAttributes[t]?this.el.triggerHandler("change:"+t,[this,e]):void 0},t.prototype.refresh=function(){return this.setAttributes()},t.prototype.name=function(){return this.el.attr("name")},t.prototype.required=function(){return this.el.hasClass("required")},t.prototype.hidden=function(){return"hidden"===this.el.attr("type")},t.prototype.value=function(){return this.el.val()},t.prototype.empty=function(){return 0===this.el.val().length},t.prototype.evaluate=function(){return $.extend(this.attributes,EvaluationRegistry.evaluate(this.el))},t.prototype.valid=function(){return!(null!=this.get("errors"))},t.prototype.setupBindings=function(){var t=this;return $(window).on("evaluation:add",function(){return t.evaluate()}),this.el.on("keyup blur focus change",function(){return t.setAttributes()})},t.prototype.saveAttributes=function(t){return this.oldAttributes=t,this.attributes={}},t.prototype.setAttributes=function(){return this.saveAttributes(this.attributes),this.set("required",this.required()),this.set("empty",this.empty()),this.get("required")&&this.get("empty")?this.set("errors",["Field required"]):this.evaluate(),this.set("name",this.name()),this.set("hidden",this.hidden()),this.set("valid",this.valid()),this.set("value",this.value())},t}(),n=function(){function t(t){this.el=$(t),this.fields=this.el.find('input:not([type="submit"]), select, textarea'),this.models=[],this.attributes={valid:!1},this.createFieldModels(),this.trackFocus(),this.trackValidity(),this.getValidity()}return t.prototype.get=function(t){return this.attributes[t]},t.prototype.set=function(t,e){var i;return i=this.attributes[t],this.attributes[t]=e,e!==this.old_attribute?this.el.triggerHandler("change:"+t,[this,e]):void 0},t.prototype.at=function(t){var e,i,n,r;for(r=this.models,i=0,n=r.length;n>i;i++)if(e=r[i],e.get("name")===t)return e},t.prototype.collect=function(t){var e,i,n,r,s;for(e={},s=this.models,n=0,r=s.length;r>n;n++)i=s[n],e[i.get("name")]=i.get(t);return e},t.prototype.refresh=function(){var t,e,i,n,r;for(n=this.models,r=[],e=0,i=n.length;i>e;e++)t=n[e],r.push(t.refresh());return r},t.prototype.createFieldModels=function(){var t,e,n,r,s,o;for(s=this.fields,o=[],n=0,r=s.length;r>n;n++)t=s[n],e=$(t).data("Field"),null==e&&(e=new i(t),$(t).data("Field",e)),o.push(this.models.push(e));return o},t.prototype.getValidity=function(){var t,e,i,n,r;for(e=!0,r=this.models,i=0,n=r.length;n>i;i++)t=r[i],t.get("valid")===!1&&(e=!1);return this.set("valid",e)},t.prototype.trackValidity=function(){var t=this;return $(this.fields).on("change:valid",function(){return t.getValidity()})},t.prototype.trackFocus=function(){var t=this;return $(this.fields).on("focus",function(e){return t.set("last_focused",$(e.target))})},t}(),t=function(){function t(t,e,i){this.selector=t,this.context=e,this.statement=i,$(window).trigger("evaluation:create",this)}return t.prototype.evaluate=function(t){return this.statement(t)},t}(),e=function(){function t(){var t=this;this.evaluations=[],$(window).on("evaluation:create",function(e,i){return t.add(i)})}return t.prototype.evaluate=function(t){var e,i,n,r,s,o;for(n={},o=this.evaluations,r=0,s=o.length;s>r;r++)e=o[r],t.is(e.selector)&&(i=e.evaluate(t),void 0!==i&&(null==n[e.context]&&(n[e.context]=[]),n[e.context].push(i)));return n},t.prototype.add=function(t){return this.evaluations.push(t),$(window).trigger("evaluation:add")},t}(),window.FieldEvaluation=t,window.EvaluationRegistry||(window.EvaluationRegistry=new e),$.fn.collectFieldData=function(){var t,e,r;return t=$(this),r='input:not([type="submit"]), select, textarea',t.is(r)?(e=t.data("Field"),null==e&&(e=new i(t),t.data("Field",e))):(e=t.data("FieldCollection"),null==e&&(e=new n(t),t.data("FieldCollection",e))),e}}).call(this);